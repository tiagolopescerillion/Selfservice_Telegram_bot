<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <meta name="operations-api-base" content="YOUR_SERVER_PUBLIC_URL" /> -->
    <meta name="operations-api-base" content="http://localhost:8080" />
    <!-- <meta name="admin-api-base" content="YOUR_SERVER_PUBLIC_URL" /> -->
    <title>Cerillion Digital IM</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar" aria-label="Application navigation">
        <div class="sidebar__title">Admin applications</div>
        <nav class="sidebar__nav">
          <button
            id="navImServerAdmin"
            class="sidebar__link active"
            type="button"
          >
            IM Server Admin
          </button>
          <button id="navConnectors" class="sidebar__link" type="button">
            Connectors
          </button>
          <button id="navServiceFunctions" class="sidebar__link" type="button">
            Service Functions
          </button>
          <button
            id="navOperationsMonitoring"
            class="sidebar__link"
            type="button"
          >
            Operations Monitoring
          </button>
          <button id="navSendMessages" class="sidebar__link" type="button">
            Send Messages
          </button>
          <button id="navMenuConfig" class="sidebar__link" type="button">
            IM Menus Configurator
          </button>
        </nav>
      </aside>

      <div class="content">
        <header>
          <h1>Cerillion Digital IM</h1>
          <p>For Telegram, WhatsApp, and Messenger</p>
        </header>
        <main>
          <section id="serviceFunctionsPanel" class="hidden">
            <section class="panel panel--wide">
              <h2>Service Functions</h2>
              <p>
                APIMAN endpoints pulled directly from
                <code>CONFIGURATIONS/application*.yml</code>. Use this view to
                confirm what URLs and query parameters are set without relying
                on the running Java services.
              </p>
              <div class="toolbar">
                <button id="addServiceFunctionButton" class="secondary" type="button">
                  Add Service Function
                </button>
                <button id="downloadQueryParamsButton" class="button" type="button">
                  Download updated application-local.yml
                </button>
              </div>
              <form id="newServiceFunctionForm" class="card hidden" autocomplete="off">
                <div class="two-col-grid">
                  <label>
                    Service function name
                    <input id="newServiceFunctionName" type="text" required placeholder="e.g. Visible mobile lines" />
                  </label>
                  <label>
                    Endpoint source
                    <select id="newServiceFunctionEndpoint" required></select>
                  </label>
                </div>
                <div class="two-col-grid">
                  <label class="checkbox">
                    <input type="checkbox" id="newServiceFunctionAccountContext" />
                    <span>Account-level context</span>
                  </label>
                  <label class="checkbox">
                    <input type="checkbox" id="newServiceFunctionServiceContext" />
                    <span>Service-level context</span>
                  </label>
                </div>
                <div>
                  <label>
                    Override query parameters
                    <input
                      id="newServiceFunctionQueryParams"
                      type="text"
                      placeholder="offset=0&limit=50"
                    />
                  </label>
                  <p class="hint">
                    Start from the endpoint defaults automatically. Toggle context checkboxes to append
                    account or service identifiers to your overrides.
                  </p>
                </div>
                <div class="toolbar toolbar--end">
                  <button id="saveNewServiceFunction" type="submit">Save service function</button>
                  <button id="cancelNewServiceFunction" type="button" class="secondary">Cancel</button>
                </div>
              </form>
              <div class="service-function-list" id="serviceFunctionsTableBody">
                <div class="empty">Loading endpointsâ€¦</div>
              </div>
              <p id="serviceFunctionsStatus" class="hint" aria-live="polite"></p>
            </section>
          </section>

          <section id="menuConfigurationPanel">
            <section class="panel">
              <h2>Menu explorer</h2>
              <p>
                Choose a menu to edit, tweak its items, or create nested
                sub-menus. The root menu is called
                <strong>Home</strong> and cannot be renamed or removed.
              </p>
              <div class="menu-mode">
                <label>
                  Configure
                  <select id="menuTypeSelect">
                    <option value="login">Login Menu Config</option>
                    <option value="business">Business Menu Config</option>
                  </select>
                </label>
                <p class="hint">
                  Switch between the login and business menus. Both menus share the same
                  configuration tools, including functions, nested sub-menus, and the
                  delete warning for cascading changes.
                </p>
              </div>
              <div class="menu-toolbar">
                <label>
                  Edit menu
                  <select id="menuSelect"></select>
                </label>
                <div class="menu-toolbar-actions">
                  <button id="createMenuButton" type="button" class="secondary">
                    Create sub-menu
                  </button>
                  <button id="deleteMenuButton" type="button" class="danger">
                    Delete selected sub-menu
                  </button>
                </div>
              </div>
              <label>
                Menu name
                <input
                  id="menuNameEditor"
                  type="text"
                  placeholder="Menu title"
                />
              </label>
              <div
                id="menuContainer"
                class="menu-list"
                aria-live="polite"
              ></div>
              <div class="panel-actions">
                <button id="resetButton" type="button" class="secondary">
                  Reset to default
                </button>
              </div>
            </section>

            <section class="panel">
              <h2>Add a menu item</h2>
              <form id="addItemForm" autocomplete="off">
                <label>
                  Place this item inside
                  <select id="parentMenuSelect" required></select>
                </label>
                <label>
                  Menu item name
                  <input
                    id="itemLabelInput"
                    name="label"
                    type="text"
                    placeholder="e.g. Manage My Services"
                    required
                  />
                </label>
                <label>
                  Menu item type
                  <select id="itemTypeSelect" required>
                    <option value="function">Function</option>
                    <option value="submenu">Sub-menu</option>
                  </select>
                </label>
                <div id="functionFields" class="conditional-field">
                  <label>
                    Menu item function
                    <select id="menuFunctionSelect" name="function"></select>
                  </label>
                  <label class="checkbox">
                    <input type="checkbox" id="useTranslationInput" />
                    <span>Use built-in translation</span>
                  </label>
                  <p class="hint">
                    Keeps the original multilingual text for this function. Turn
                    it off to always display the custom label.
                  </p>
                </div>
                <div id="submenuFields" class="conditional-field hidden">
                  <label>
                    Target sub-menu
                    <select id="submenuSelect"></select>
                  </label>
                  <button
                    id="inlineCreateSubmenu"
                    type="button"
                    class="secondary"
                  >
                    Create new sub-menu
                  </button>
                  <p class="hint">
                    Sub-menus can be nested infinitely. When you delete a
                    sub-menu, all of its child items and menus are removed.
                  </p>
                </div>
                <button type="submit">Add item</button>
              </form>
              <p class="hint">
                The function list mirrors the services available in the current
                Telegram bot. As new services are developed they can be appended
                here without changing the Java backend.
              </p>
            </section>

            <section class="panel">
              <h2>Configuration output</h2>
              <p>
                Download the JSON file, rename it to
                <code>IM-menus.override.json</code>, and copy it into the
                <code>CONFIGURATIONS/</code> directory next to the Telegram bot
                to override the default order. When no override exists the bot
                keeps the packaged <code>IM-menus.default.json</code>.
              </p>
              <div class="panel-actions">
                <label class="file-input">
                  <span>Load existing configuration</span>
                  <input
                    type="file"
                    id="importInput"
                    accept="application/json"
                  />
                </label>
                <button id="downloadButton" type="button">
                  Download configuration
                </button>
              </div>
              <pre id="preview" class="preview" aria-live="polite"></pre>
            </section>
          </section>

          <section id="operationsMonitoringPanel" class="hidden">
            <section class="panel panel--wide">
              <h2>Operations Monitoring</h2>
              <p>
                Track live chat sessions and sign-in activity in near real time.
                The lists refresh automatically while preserving the familiar
                Cerillion Digital IM look and feel.
              </p>
              <div class="monitoring-config">
                <label>
                  Monitoring API base URL
                  <input
                    id="monitoringApiBase"
                    type="text"
                    value="YOUR_SERVER_PUBLIC_URL"
                    readonly
                  />
                </label>
                <p class="hint">
                  Populated from the <code>public-base-url</code> application
                  property. Copy this value when hosting the UI separately so
                  the Operations Monitoring API can be reached.
                </p>
              </div>
              <div class="monitoring-vertical">
                <div class="monitoring-card">
                  <div class="monitoring-card__header">
                    <div>
                      <h3>Ongoing sessions</h3>
                      <p class="hint">
                        Live conversations currently in progress.
                      </p>
                    </div>
                    <span class="pill pill--live" aria-label="Live sessions"
                      >Live</span
                    >
                  </div>
                  <div class="list-header">
                    <span>Channel</span>
                    <span>Chat ID / Session ID</span>
                    <span>Login status &amp; username</span>
                    <span>Opt-in status</span>
                    <span>Token</span>
                    <span>Session start date</span>
                    <span>Session start time</span>
                  </div>
                  <div
                    id="liveSessions"
                    class="session-list scrollable-list"
                    aria-live="polite"
                  ></div>
                </div>

                <div class="monitoring-card">
                  <div class="monitoring-card__header">
                    <div>
                      <h3>Recent history</h3>
                      <p class="hint">
                        Completed sessions move here automatically.
                      </p>
                    </div>
                    <span class="pill">History</span>
                  </div>
                  <div class="list-header">
                    <span>Channel</span>
                    <span>Chat ID / Session ID</span>
                    <span>Login status &amp; username</span>
                    <span>Opt-in status</span>
                    <span>Token</span>
                    <span>Session start date</span>
                    <span>Session start time</span>
                  </div>
                  <div
                    id="sessionHistory"
                    class="session-list scrollable-list"
                    aria-live="polite"
                  ></div>
                </div>
              </div>
            </section>
          </section>

          <section id="sendMessagesPanel" class="hidden">
            <section class="panel panel--wide">
              <h2>Send Messages</h2>
              <p>
                Deliver notifications to opted-in users on Telegram or WhatsApp.
                Users must grant consent from their chat session before any
                outbound message is sent.
              </p>
              <div class="monitoring-config">
                <label>
                  Notifications API base URL
                  <input
                    id="notificationApiBase"
                    type="text"
                    value="YOUR_SERVER_PUBLIC_URL"
                    readonly
                  />
                </label>
                <p class="hint">
                  Populated from the <code>public-base-url</code> application
                  property. Copy this value when hosting the UI separately so
                  the <code>/notifications</code> endpoint can be reached.
                </p>
              </div>
              <form
                id="sendMessageForm"
                class="send-message-form"
                autocomplete="off"
              >
                <label>
                  Channel
                  <select id="notificationChannel" required>
                    <option value="telegram">Telegram</option>
                    <option value="whatsapp">WhatsApp</option>
                  </select>
                </label>
                <label>
                  Chat ID / Phone Number
                  <input
                    id="notificationChatId"
                    type="text"
                    placeholder="e.g. 123456789"
                    required
                  />
                </label>
                <label>
                  Message
                  <textarea
                    id="notificationMessage"
                    rows="4"
                    placeholder="Type the notification to send"
                    required
                  ></textarea>
                </label>
                <div class="panel-actions">
                  <button type="submit">Send notification</button>
                </div>
              </form>
              <div
                id="notificationResult"
                class="notification-result"
                aria-live="polite"
              ></div>
            </section>
          </section>

          <section id="connectorsPanel" class="hidden">
            <section class="panel panel--wide">
              <div class="panel-heading">
                <div>
                  <h2>Connectors</h2>
                  <p>
                    Manage channel availability flags and individual connector settings. Values are read directly from
                    the <code>CONFIGURATIONS/</code> directory.
                  </p>
                </div>
              </div>

              <div class="tabs" role="tablist" aria-label="Connector configuration">
                <button class="tab active" data-connectors-tab="general" type="button">General</button>
                <button class="tab" data-connectors-tab="telegram" type="button">Telegram</button>
                <button class="tab" data-connectors-tab="whatsapp" type="button">WhatsApp</button>
                <button class="tab" data-connectors-tab="messenger" type="button">Messenger</button>
              </div>

              <div class="connector-tab connector-tab--active" data-connectors-tab-panel="general">
                <div class="monitoring-config config-viewer__header">
                  <div>
                    <div class="hint">Configuration source</div>
                    <div id="connectorsFileName" class="config-viewer__filename">Loading...</div>
                  </div>
                  <div id="connectorsStatus" class="hint"></div>
                </div>
                <p class="hint">
                  Use the switches to enable or disable each messaging channel. Changes are reflected below and can be
                  downloaded as <code>connectors-local.yml</code>.
                </p>
                <div class="switch-grid">
                  <div class="switch-tile">
                    <div class="switch-text">
                      <div class="switch-label">Telegram</div>
                      <div class="switch-subtitle">Toggle the Telegram connector availability.</div>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="telegramConnectorToggle" />
                      <span class="switch-slider" aria-hidden="true"></span>
                      <span class="switch-value">On</span>
                    </label>
                  </div>
                  <div class="switch-tile">
                    <div class="switch-text">
                      <div class="switch-label">WhatsApp</div>
                      <div class="switch-subtitle">Toggle the WhatsApp connector availability.</div>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="whatsappConnectorToggle" />
                      <span class="switch-slider" aria-hidden="true"></span>
                      <span class="switch-value">On</span>
                    </label>
                  </div>
                  <div class="switch-tile">
                    <div class="switch-text">
                      <div class="switch-label">Messenger</div>
                      <div class="switch-subtitle">Toggle the Messenger connector availability.</div>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="messengerConnectorToggle" />
                      <span class="switch-slider" aria-hidden="true"></span>
                      <span class="switch-value">On</span>
                    </label>
                  </div>
                </div>
                <div class="config-editor">
                  <div id="connectorsConfigTree" class="config-tree"></div>
                </div>
                <div class="connector-preview">
                  <div class="connector-preview__header">
                    <div class="hint">Generated connectors-local.yml</div>
                  </div>
                  <pre
                    id="connectorsPreview"
                    class="preview config-preview"
                    aria-live="polite"
                  ></pre>
                </div>
                <div class="download-actions">
                  <button id="connectorsDownloadButton" type="button" class="button">
                    Download connectors-local.yml
                  </button>
                </div>
              </div>

              <div class="connector-tab" data-connectors-tab-panel="telegram">
                <div class="connector-tab__header">
                  <div>
                    <div class="switch-label">Telegram configuration</div>
                    <div id="telegramConfigStatus" class="hint"></div>
                  </div>
                </div>
                <div id="telegramDisabledMessage" class="empty-state hidden" aria-live="polite">
                  Telegram is disabled in your configuration.
                </div>
                <div class="config-editor">
                  <div
                    id="telegramConfigTree"
                    class="config-tree"
                    aria-label="telegram-local.yml editor"
                  ></div>
                </div>
                <div class="connector-preview">
                  <div class="connector-preview__header">
                    <div class="hint">Generated telegram-local.yml</div>
                  </div>
                  <pre
                    id="telegramPreview"
                    class="preview config-preview"
                    aria-live="polite"
                  ></pre>
                </div>
                <div class="download-actions">
                  <button id="telegramDownloadButton" type="button" class="button">
                    Download telegram-local.yml
                  </button>
                </div>
              </div>

              <div class="connector-tab" data-connectors-tab-panel="whatsapp">
                <div class="connector-tab__header">
                  <div>
                    <div class="switch-label">WhatsApp configuration</div>
                    <div id="whatsappConfigStatus" class="hint"></div>
                  </div>
                </div>
                <div id="whatsappDisabledMessage" class="empty-state hidden" aria-live="polite">
                  WhatsApp is disabled in your configuration.
                </div>
                <div class="config-editor">
                  <div
                    id="whatsappConfigTree"
                    class="config-tree"
                    aria-label="whatsapp-local.yml editor"
                  ></div>
                </div>
                <div class="connector-preview">
                  <div class="connector-preview__header">
                    <div class="hint">Generated whatsapp-local.yml</div>
                  </div>
                  <pre
                    id="whatsappPreview"
                    class="preview config-preview"
                    aria-live="polite"
                  ></pre>
                </div>
                <div class="download-actions">
                  <button id="whatsappDownloadButton" type="button" class="button">
                    Download whatsapp-local.yml
                  </button>
                </div>
              </div>

              <div class="connector-tab" data-connectors-tab-panel="messenger">
                <div class="connector-tab__header">
                  <div>
                    <div class="switch-label">Messenger configuration</div>
                    <div id="messengerConfigStatus" class="hint"></div>
                  </div>
                </div>
                <div id="messengerDisabledMessage" class="empty-state hidden" aria-live="polite">
                  Messenger is disabled in your configuration.
                </div>
                <div class="config-editor">
                  <div
                    id="messengerConfigTree"
                    class="config-tree"
                    aria-label="messenger-local.yml editor"
                  ></div>
                </div>
                <div class="connector-preview">
                  <div class="connector-preview__header">
                    <div class="hint">Generated messenger-local.yml</div>
                  </div>
                  <pre
                    id="messengerPreview"
                    class="preview config-preview"
                    aria-live="polite"
                  ></pre>
                </div>
                <div class="download-actions">
                  <button id="messengerDownloadButton" type="button" class="button">
                    Download messenger-local.yml
                  </button>
                </div>
              </div>
            </section>
          </section>

          <section id="imServerAdminPanel" class="hidden">
            <section class="panel panel--wide">
              <h2>IM Server Admin</h2>
              <p>
                Review the active configuration that drives the Cerillion
                Digital IM Server. When available, the server prioritises
                <code>application-local.yml</code>; otherwise the
                <code>application-example.yml</code> baseline is shown.
              </p>
              <div class="monitoring-config config-viewer__header">
                <div>
                  <div class="hint">Configuration source</div>
                  <div id="configFileName" class="config-viewer__filename">
                    Loading...
                  </div>
                </div>
                <div class="panel-actions">
                  <button
                    id="refreshConfigButton"
                    type="button"
                    class="secondary"
                  >
                    Reload configuration
                  </button>
                </div>
              </div>
              <div id="configStatus" class="hint"></div>
              <p class="hint">
                Values are editable for review purposes only. Future updates
                will allow saving the file back to the server.
              </p>
              <div class="config-editor">
                <div
                  id="configEmptyState"
                  class="config-empty hidden"
                  aria-live="polite"
                >
                  Configuration entries are not available.
                </div>
                <div
                  id="configTree"
                  class="config-tree"
                  aria-live="polite"
                ></div>
              </div>
              <details class="config-raw">
                <summary>Show raw configuration</summary>
                <pre
                  id="imConfigContent"
                  class="preview config-preview"
                  aria-live="polite"
                ></pre>
              </details>
            </section>
          </section>
        </main>
      </div>
    </div>
    <script src="app.js"></script>
  </body>
</html>
